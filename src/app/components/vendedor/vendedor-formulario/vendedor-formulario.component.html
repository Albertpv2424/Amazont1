<div class="form-container" [ngClass]="{'dark-mode': isDarkMode}">
  <h1>{{ isEditing ? 'Editar Producto' : 'Añadir Nuevo Producto' }}</h1>

  <div *ngIf="error" class="error-message">
    <i class="fas fa-exclamation-circle"></i> {{ error }}
  </div>

  <div *ngIf="isLoading" class="loading">
    <i class="fas fa-spinner fa-spin"></i> Cargando datos del producto...
  </div>

  <form [formGroup]="productoForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading">
    <div class="form-group">
      <label for="nombre">Nombre del Producto*</label>
      <input type="text" id="nombre" formControlName="nombre" placeholder="Nombre del producto">
      <div *ngIf="isInvalid('nombre')" class="error-text">
        El nombre es obligatorio y debe tener al menos 3 caracteres
      </div>
    </div>

    <div class="form-group">
      <label for="descripcion">Descripción*</label>
      <textarea id="descripcion" formControlName="descripcion" rows="4" placeholder="Descripción detallada del producto"></textarea>
      <div *ngIf="isInvalid('descripcion')" class="error-text">
        La descripción es obligatoria
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="precio">Precio (€)*</label>
        <input type="number" id="precio" formControlName="precio" step="0.01" min="0.01" placeholder="0.00">
        <div *ngIf="isInvalid('precio')" class="error-text">
          El precio es obligatorio y debe ser mayor que 0
        </div>
      </div>

      <div class="form-group">
        <label for="stock">Stock*</label>
        <input type="number" id="stock" formControlName="stock" min="0" placeholder="0">
        <div *ngIf="isInvalid('stock')" class="error-text">
          El stock es obligatorio y no puede ser negativo
        </div>
      </div>
    </div>

    <div class="form-group checkbox-group">
      <input type="checkbox" id="en_oferta" formControlName="en_oferta">
      <label for="en_oferta">¿Está en oferta?</label>
    </div>

    <div class="form-group" *ngIf="productoForm.get('en_oferta')?.value">
      <label for="precio_oferta">Precio de Oferta (€)*</label>
      <input type="number" id="precio_oferta" formControlName="precio_oferta" step="0.01" min="0.01" placeholder="0.00">
      <div *ngIf="isInvalid('precio_oferta')" class="error-text">
        El precio de oferta es obligatorio y debe ser mayor que 0
      </div>
    </div>

    <div class="form-group">
      <label for="categorias">Categorías*</label>
      <div class="categoria-selector">
        <div *ngFor="let categoria of categorias" class="categoria-option">
          <input type="checkbox"
                 [id]="'cat_' + categoria.id_cat"
                 [value]="categoria.id_cat"
                 (change)="toggleCategoria(categoria.id_cat)">
          <label [for]="'cat_' + categoria.id_cat">{{ categoria.nombre }}</label>
        </div>
      </div>
      <div *ngIf="isInvalid('categorias')" class="error-text">
        Debe seleccionar al menos una categoría
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn-cancel" routerLink="/vendedor/productos">Cancelar</button>
      <button type="submit" class="btn-submit" [disabled]="isSubmitting || productoForm.invalid">
        {{ isSubmitting ? 'Guardando...' : (isEditing ? 'Actualizar Producto' : 'Crear Producto') }}
      </button>
    </div>
  </form>
</div>