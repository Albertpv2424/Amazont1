<header class="header">
  <div class="logo">
    <a [routerLink]="['/']"><img src="assets/amazont en blanc.png" alt="Logo" /></a>
  </div>

  <div class="search-container">
    <select class="dropdown" (change)="onCategoryChange($event)">
      <option value="">Todas las categorías</option>
      @for (categoria of categorias; track categoria.nombre) {
        <option [value]="categoria.nombre">{{ categoria.nombre }}</option>
      }
    </select>
    <div class="search-input-wrapper">
      <input 
        type="text" 
        class="search-input" 
        placeholder="Buscar en Amazon't" 
        [(ngModel)]="searchTerm"
        (input)="onSearchInput()"
        (keyup.enter)="buscarProductos()"
        (blur)="hideSuggestions()"
      />
      @if (showSuggestions && filteredProducts.length > 0) {
        <div class="search-suggestions">
          @for (producto of filteredProducts; track producto.id) {
            <div class="suggestion-item" (mousedown)="selectSuggestion(producto)">
              <div class="suggestion-icon">
                <img src="assets/search 1.png" alt="" class="search-icon">
              </div>
              <div class="suggestion-text">{{ producto.nombre }}</div>
            </div>
          }
        </div>
      }
    </div>
    <div class="search-button-container">
      <button class="search-button" (click)="buscarProductos()">
        <img src="assets/search 1.png" alt="Buscar" />
      </button>
    </div>
  </div>

  <div class="icons">
    <!-- User authentication buttons -->
    <div class="auth-buttons">
      <ng-container *ngIf="!isLoggedIn; else loggedInTemplate">
        <a routerLink="/login" class="auth-link">Iniciar sesión</a>
        <a routerLink="/registro" class="auth-link">Registrarse</a>
      </ng-container>
      <ng-template #loggedInTemplate>
        <span class="user-greeting">Hola, {{ userName }}</span>
        <a (click)="logout()" class="auth-link">Cerrar sesión</a>
      </ng-template>
    </div>
    
    <!-- Add this somewhere in your header if it's not already there -->
    <div class="carrito-icon" (click)="navegarAlCarrito()">
      <img src="assets/cart.png" alt="Carrito de compras">
      @if (cantidadCarrito > 0) {
        <span class="carrito-badge">{{ cantidadCarrito }}</span>
      }
    </div>
    <img src="assets/settings.png" alt="Ajustes" (click)="navegarAjustes()" style="cursor:pointer;" />
    <a (click)="toggleBackground()" class="toggle-button">
      <img [src]="isDarkMode ? 'assets/sol1.png' : 'assets/luna1.png'" alt="Toggle Background" />
    </a>
  </div>
</header>
